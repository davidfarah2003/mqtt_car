{"ast":null,"code":"import { ref } from \"vue\";\nimport mqtt from \"precompiled-mqtt\";\n\n/**\n * Asynchronous method that returns a promise, from which we can obtain the mqtt client if resolved.\n * We use the MQTT.js library to communicate with broker through websockets (Not TCP - that's why I used precompiled-mqtt)\n * @returns client\n */\nconst getMqttClient = async () => {\n  const clientId = \"SSB_interface\";\n  const host = 'ws://localhost:9001';\n  const options = {\n    keepalive: 60,\n    clientId: clientId,\n    protocolId: 'MQTT',\n    protocolVersion: 4,\n    clean: true,\n    reconnectPeriod: 1000,\n    connectTimeout: 30 * 1000,\n    will: {\n      topic: 'WillMsg',\n      payload: 'Connection Closed abnormally..!',\n      qos: 0,\n      retain: false\n    }\n  };\n  const client = await getClient(host, options);\n  client.on('error', err => {\n    console.log('Connection error: ', err);\n  });\n  client.on('reconnect', () => {\n    console.log('Reconnecting...');\n  });\n  client.on('connect', () => {\n    console.log('Connected to broker');\n  });\n  return client;\n};\nconst getClient = (host, options) => {\n  return new Promise((resolve, reject) => {\n    const client = mqtt.connect(host, options);\n    if (client) {\n      resolve(client);\n    } else reject(\"Client connection couldn't be established \");\n  });\n};\nexport default getMqttClient;","map":{"version":3,"names":["ref","mqtt","getMqttClient","clientId","host","options","keepalive","protocolId","protocolVersion","clean","reconnectPeriod","connectTimeout","will","topic","payload","qos","retain","client","getClient","on","err","console","log","Promise","resolve","reject","connect"],"sources":["/home/davidf/Desktop/SSB/ssb-interface-v2/src/composables/getMqttClient.js"],"sourcesContent":["import {ref} from \"vue\"\nimport mqtt from \"precompiled-mqtt\";\n\n/**\n * Asynchronous method that returns a promise, from which we can obtain the mqtt client if resolved.\n * We use the MQTT.js library to communicate with broker through websockets (Not TCP - that's why I used precompiled-mqtt)\n * @returns client\n */\nconst getMqttClient = async () => {\n    const clientId = \"SSB_interface\"\n    const host = 'ws://localhost:9001'\n\n    const options = {\n        keepalive: 60,\n        clientId: clientId,\n        protocolId: 'MQTT',\n        protocolVersion: 4,\n        clean: true,\n        reconnectPeriod: 1000,\n        connectTimeout: 30 * 1000,\n        will: {\n            topic: 'WillMsg',\n            payload: 'Connection Closed abnormally..!',\n            qos: 0,\n            retain: false\n        },\n    }\n\n    const client = await getClient(host, options)\n\n    client.on('error', (err) => {\n        console.log('Connection error: ', err)\n    })\n    client.on('reconnect', () => {\n        console.log('Reconnecting...')\n    })\n    client.on('connect', () => {\n        console.log('Connected to broker')\n    })\n\n    return client;\n}\n\nconst getClient = (host, options) => {\n    return new Promise((resolve, reject) => {\n        const client = mqtt.connect(host, options)\n\n        if(client){resolve(client)}\n        else reject(\"Client connection couldn't be established \")\n    })\n}\n\nexport default getMqttClient"],"mappings":"AAAA,SAAQA,GAAG,QAAO,KAAK;AACvB,OAAOC,IAAI,MAAM,kBAAkB;;AAEnC;AACA;AACA;AACA;AACA;AACA,MAAMC,aAAa,GAAG,YAAY;EAC9B,MAAMC,QAAQ,GAAG,eAAe;EAChC,MAAMC,IAAI,GAAG,qBAAqB;EAElC,MAAMC,OAAO,GAAG;IACZC,SAAS,EAAE,EAAE;IACbH,QAAQ,EAAEA,QAAQ;IAClBI,UAAU,EAAE,MAAM;IAClBC,eAAe,EAAE,CAAC;IAClBC,KAAK,EAAE,IAAI;IACXC,eAAe,EAAE,IAAI;IACrBC,cAAc,EAAE,EAAE,GAAG,IAAI;IACzBC,IAAI,EAAE;MACFC,KAAK,EAAE,SAAS;MAChBC,OAAO,EAAE,iCAAiC;MAC1CC,GAAG,EAAE,CAAC;MACNC,MAAM,EAAE;IACZ;EACJ,CAAC;EAED,MAAMC,MAAM,GAAG,MAAMC,SAAS,CAACd,IAAI,EAAEC,OAAO,CAAC;EAE7CY,MAAM,CAACE,EAAE,CAAC,OAAO,EAAGC,GAAG,IAAK;IACxBC,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEF,GAAG,CAAC;EAC1C,CAAC,CAAC;EACFH,MAAM,CAACE,EAAE,CAAC,WAAW,EAAE,MAAM;IACzBE,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;EAClC,CAAC,CAAC;EACFL,MAAM,CAACE,EAAE,CAAC,SAAS,EAAE,MAAM;IACvBE,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAC;EACtC,CAAC,CAAC;EAEF,OAAOL,MAAM;AACjB,CAAC;AAED,MAAMC,SAAS,GAAG,CAACd,IAAI,EAAEC,OAAO,KAAK;EACjC,OAAO,IAAIkB,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACpC,MAAMR,MAAM,GAAGhB,IAAI,CAACyB,OAAO,CAACtB,IAAI,EAAEC,OAAO,CAAC;IAE1C,IAAGY,MAAM,EAAC;MAACO,OAAO,CAACP,MAAM,CAAC;IAAA,CAAC,MACtBQ,MAAM,CAAC,4CAA4C,CAAC;EAC7D,CAAC,CAAC;AACN,CAAC;AAED,eAAevB,aAAa"},"metadata":{},"sourceType":"module"}