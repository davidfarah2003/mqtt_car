{"ast":null,"code":"import { ref } from \"vue\";\nimport { AsyncClient } from \"async-mqtt\";\nimport mqtt from \"precompiled-mqtt\";\n\n/**\n * Use the MQTT.js library to communicate with broker through websockets (Not TCP - that's why I used precompiled-mqtt)\n * @returns {{}}\n */\nconst getMqttClient = () => {\n  const {\n    AsyncClient\n  } = require(\"async-mqtt\");\n  const mqtt = require('precompiled-mqtt');\n  const options = {\n    // Clean session\n    clean: true,\n    connectTimeout: 4000\n    // Auth\n    //clientId: 'emqx_test',\n    //username: 'emqx_test',\n    //password: 'emqx_test',\n  };\n\n  //const client  = mqtt.connect('mqtt://broker.emqx.io:1883', options)\n\n  let client = ref(null);\n  const connect = async () => {\n    client = ref(await mqtt.connect('mqtt://127.0.0.1:9001'));\n    const asyncClient = new AsyncClient(client);\n    client.value.on('connect', function () {\n      console.log('Connected');\n      client.value.subscribe('test', function (err) {\n        if (!err) {\n          client.value.publish('test', 'Hello mqtt');\n        }\n      });\n    });\n    client.value.on('message', function (topic, message) {\n      // message is Buffer\n      console.log(message.toString());\n    });\n  };\n  return {\n    connect,\n    client\n  };\n};\nexport default getMqttClient;","map":{"version":3,"names":["ref","AsyncClient","mqtt","getMqttClient","require","options","clean","connectTimeout","client","connect","asyncClient","value","on","console","log","subscribe","err","publish","topic","message","toString"],"sources":["/home/davidf/Desktop/SSB/ssb-interface-v2/src/composables/getMqttClient.js"],"sourcesContent":["import {ref} from \"vue\";\nimport {AsyncClient} from \"async-mqtt\";\nimport mqtt from \"precompiled-mqtt\";\n\n/**\n * Use the MQTT.js library to communicate with broker through websockets (Not TCP - that's why I used precompiled-mqtt)\n * @returns {{}}\n */\nconst getMqttClient = () => {\n    const { AsyncClient } = require(\"async-mqtt\");\n    const mqtt = require('precompiled-mqtt')\n\n\n    const options = {\n        // Clean session\n        clean: true,\n        connectTimeout: 4000,\n        // Auth\n        //clientId: 'emqx_test',\n        //username: 'emqx_test',\n        //password: 'emqx_test',\n    }\n\n    //const client  = mqtt.connect('mqtt://broker.emqx.io:1883', options)\n\n    let client = ref(null)\n    const connect = async () => {\n        client  = ref( await mqtt.connect('mqtt://127.0.0.1:9001'))\n        const asyncClient = new AsyncClient(client);\n\n        client.value.on('connect', function () {\n            console.log('Connected')\n            client.value.subscribe('test', function (err) {\n                if (!err) {\n                    client.value.publish('test', 'Hello mqtt')\n                }\n            })\n        });\n\n        client.value.on('message', function (topic, message) {\n            // message is Buffer\n            console.log(message.toString())\n        });\n    }\n\n    return {connect, client}\n}\n\nexport default getMqttClient"],"mappings":"AAAA,SAAQA,GAAG,QAAO,KAAK;AACvB,SAAQC,WAAW,QAAO,YAAY;AACtC,OAAOC,IAAI,MAAM,kBAAkB;;AAEnC;AACA;AACA;AACA;AACA,MAAMC,aAAa,GAAG,MAAM;EACxB,MAAM;IAAEF;EAAY,CAAC,GAAGG,OAAO,CAAC,YAAY,CAAC;EAC7C,MAAMF,IAAI,GAAGE,OAAO,CAAC,kBAAkB,CAAC;EAGxC,MAAMC,OAAO,GAAG;IACZ;IACAC,KAAK,EAAE,IAAI;IACXC,cAAc,EAAE;IAChB;IACA;IACA;IACA;EACJ,CAAC;;EAED;;EAEA,IAAIC,MAAM,GAAGR,GAAG,CAAC,IAAI,CAAC;EACtB,MAAMS,OAAO,GAAG,YAAY;IACxBD,MAAM,GAAIR,GAAG,CAAE,MAAME,IAAI,CAACO,OAAO,CAAC,uBAAuB,CAAC,CAAC;IAC3D,MAAMC,WAAW,GAAG,IAAIT,WAAW,CAACO,MAAM,CAAC;IAE3CA,MAAM,CAACG,KAAK,CAACC,EAAE,CAAC,SAAS,EAAE,YAAY;MACnCC,OAAO,CAACC,GAAG,CAAC,WAAW,CAAC;MACxBN,MAAM,CAACG,KAAK,CAACI,SAAS,CAAC,MAAM,EAAE,UAAUC,GAAG,EAAE;QAC1C,IAAI,CAACA,GAAG,EAAE;UACNR,MAAM,CAACG,KAAK,CAACM,OAAO,CAAC,MAAM,EAAE,YAAY,CAAC;QAC9C;MACJ,CAAC,CAAC;IACN,CAAC,CAAC;IAEFT,MAAM,CAACG,KAAK,CAACC,EAAE,CAAC,SAAS,EAAE,UAAUM,KAAK,EAAEC,OAAO,EAAE;MACjD;MACAN,OAAO,CAACC,GAAG,CAACK,OAAO,CAACC,QAAQ,EAAE,CAAC;IACnC,CAAC,CAAC;EACN,CAAC;EAED,OAAO;IAACX,OAAO;IAAED;EAAM,CAAC;AAC5B,CAAC;AAED,eAAeL,aAAa"},"metadata":{},"sourceType":"module"}